<!DOCTYPE html>


  <html class="dark page-post">


<head>
  <meta charset="utf-8">
  
  <title>加密你的App | RobinBlog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="NDK,加密,Conceal,encrypt," />
  

  <meta name="description" content="企业级开发中加密数据一般都少不了，我们在与服务端交互中，发送的参数以及获取的数据都是加密后的，需要客户端与服务端互相加解密初期我们使用了java提供的Cipher类，加解密效果是达到了，但是缺点也是明显的：太慢。每次加密过程一串不长的Json就将近1秒左右，为此不得不另外再开异步执行加解密，这样繁琐不简洁，整个APP的速度也被拖慢。 加密手段SqlCipher,Conceal. SqlCipher">
<meta name="keywords" content="NDK,加密,Conceal,encrypt">
<meta property="og:type" content="article">
<meta property="og:title" content="加密你的App">
<meta property="og:url" content="http://yoursite.com/2016/11/30/加密你的App/index.html">
<meta property="og:site_name" content="RobinBlog">
<meta property="og:description" content="企业级开发中加密数据一般都少不了，我们在与服务端交互中，发送的参数以及获取的数据都是加密后的，需要客户端与服务端互相加解密初期我们使用了java提供的Cipher类，加解密效果是达到了，但是缺点也是明显的：太慢。每次加密过程一串不长的Json就将近1秒左右，为此不得不另外再开异步执行加解密，这样繁琐不简洁，整个APP的速度也被拖慢。 加密手段SqlCipher,Conceal. SqlCipher">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-08-30T09:57:05.022Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="加密你的App">
<meta name="twitter:description" content="企业级开发中加密数据一般都少不了，我们在与服务端交互中，发送的参数以及获取的数据都是加密后的，需要客户端与服务端互相加解密初期我们使用了java提供的Cipher类，加解密效果是达到了，但是缺点也是明显的：太慢。每次加密过程一串不长的Json就将近1秒左右，为此不得不另外再开异步执行加解密，这样繁琐不简洁，整个APP的速度也被拖慢。 加密手段SqlCipher,Conceal. SqlCipher">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=d671a41f" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e0de6832e0e2c08124df0019a7ce1b56";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#加密手段"><span class="toc-text">加密手段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Conceal使用"><span class="toc-text">Conceal使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#在项目的Application的onCreate-函数中初始化"><span class="toc-text">在项目的Application的onCreate()函数中初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#加密字符串"><span class="toc-text">加密字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解密字符串"><span class="toc-text">解密字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#加密文件"><span class="toc-text">加密文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解密文件"><span class="toc-text">解密文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SecretKey"><span class="toc-text">SecretKey</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建一个SecretKeyHelper类"><span class="toc-text">创建一个SecretKeyHelper类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C-实现"><span class="toc-text">C++实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#头文件secretkey-h"><span class="toc-text">头文件secretkey.h</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#cpp文件secretkey-cpp"><span class="toc-text">cpp文件secretkey.cpp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Application-mk文件"><span class="toc-text">Application.mk文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Android-mk文件"><span class="toc-text">Android.mk文件</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码获取"><span class="toc-text">代码获取</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-加密你的App" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">加密你的App</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2016.11.30</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Robin</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Android/">Android</a> / <a class="article-category-link" href="/categories/Android/NDK/">NDK</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

    </div>
  </header>

  <div class="article-content">
    
      <p>企业级开发中加密数据一般都少不了，我们在与服务端交互中，发送的参数以及获取的数据都是加密后的，需要客户端与服务端互相加解密<br>初期我们使用了java提供的Cipher类，加解密效果是达到了，但是缺点也是明显的：太慢。每次加密过程一串不长的Json就将近1秒左右，为此不得不另外再开异步执行加解密，这样繁琐不简洁，整个APP的速度也被拖慢。</p>
<h2 id="加密手段"><a href="#加密手段" class="headerlink" title="加密手段"></a>加密手段</h2><p>SqlCipher,Conceal.</p>
<p>SqlCipher主要是数据库加密，此处与我们的场景对应不上，不考虑</p>
<p>Conceal是Facebook出的，时间也不短了，之前只能引入jar和so文件，现在可以直接gradle依赖了</p>
<h3 id="Conceal使用"><a href="#Conceal使用" class="headerlink" title="Conceal使用"></a>Conceal使用</h3><p>build.gradle添加依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">   	compile <span class="string">'com.facebook.conceal:conceal:1.1.3@aar'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了使用方面，我封装成了一个类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.robinx.lib.encrypt.conceal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.text.TextUtils;</span><br><span class="line"><span class="keyword">import</span> android.util.Base64;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.facebook.android.crypto.keychain.AndroidConceal;</span><br><span class="line"><span class="keyword">import</span> com.facebook.android.crypto.keychain.SharedPrefsBackedKeyChain;</span><br><span class="line"><span class="keyword">import</span> com.facebook.crypto.Crypto;</span><br><span class="line"><span class="keyword">import</span> com.facebook.crypto.CryptoConfig;</span><br><span class="line"><span class="keyword">import</span> com.facebook.crypto.Entity;</span><br><span class="line"><span class="keyword">import</span> com.facebook.crypto.exception.CryptoInitializationException;</span><br><span class="line"><span class="keyword">import</span> com.facebook.crypto.exception.KeyChainException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.robinx.lib.encrypt.SecretKeyHelper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Robin on 2016/11/16 10:27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ConcealHelper &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ConcealHelper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_ENCODE = <span class="string">"utf-8"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX_E = <span class="string">"encrypt_"</span>, PREFIX_D = <span class="string">"decrypt_"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SharedPrefsBackedKeyChain msp;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Crypto mCrypto;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Entity mEntity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == mCrypto) &#123;</span><br><span class="line">            msp = <span class="keyword">new</span> SharedPrefsBackedKeyChain(context, CryptoConfig.KEY_256);</span><br><span class="line">            mCrypto = AndroidConceal.get().createDefaultCrypto(msp);</span><br><span class="line">            String secretKey = SecretKeyHelper.getSecretKey(context);</span><br><span class="line">            mEntity = Entity.create(secretKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加密字节数组</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> plainBytes 原始字节数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 密文字节数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encryptByte(<span class="keyword">byte</span>[] plainBytes) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mCrypto.isAvailable()) &#123;</span><br><span class="line">            Log.e(<span class="string">"system.out"</span>, <span class="string">"encryptByte error: mCrypto is unavailable"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == plainBytes || plainBytes.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            Log.e(<span class="string">"system.out"</span>, <span class="string">"encryptByte error: plainBytes is null or length &lt;= 0"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] result = mCrypto.encrypt(plainBytes, mEntity);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == result || result.length == <span class="number">0</span>) &#123;</span><br><span class="line">                Log.e(<span class="string">"system.out"</span>, <span class="string">"encryptByte error: result is null or length &lt;= 0"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyChainException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CryptoInitializationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解密字节数组</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encryptBytes 密文字节数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 原始字节数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decryptByte(<span class="keyword">byte</span>[] encryptBytes) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mCrypto.isAvailable()) &#123;</span><br><span class="line">            Log.e(<span class="string">"system.out"</span>, <span class="string">"decryptByte error: mCrypto is unavailable"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == encryptBytes || encryptBytes.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            Log.e(<span class="string">"system.out"</span>, <span class="string">"decryptByte error: encryptBytes is null or length &lt;= 0"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] result = mCrypto.decrypt(encryptBytes, mEntity);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == result || result.length == <span class="number">0</span>) &#123;</span><br><span class="line">                Log.e(<span class="string">"system.out"</span>, <span class="string">"decryptByte error: result is null or length &lt;= 0"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyChainException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CryptoInitializationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加密字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> plainText 原始字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 加密后字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encryptString</span><span class="params">(String plainText)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(plainText)) &#123;</span><br><span class="line">            Log.e(<span class="string">"system.out"</span>, <span class="string">"encryptString error: plainText is empty"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] plainTextBytes = plainText.getBytes(DEFAULT_ENCODE);</span><br><span class="line">            <span class="keyword">byte</span>[] result = encryptByte(plainTextBytes);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == result || result.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                Log.e(<span class="string">"system.out"</span>, <span class="string">"encryptString error: encrypt result is null or length &lt;= 0"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String encryptText = Base64.encodeToString(result, Base64.DEFAULT);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> encryptText;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解密字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encryptText 密文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 原始字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decryptString</span><span class="params">(String encryptText)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(encryptText)) &#123;</span><br><span class="line">            Log.e(<span class="string">"system.out"</span>, <span class="string">"decryptString error: encryptText is empty"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] encryptTextBytes = Base64.decode(encryptText, Base64.DEFAULT);</span><br><span class="line">        <span class="keyword">byte</span>[] data = decryptByte(encryptTextBytes);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == data || data.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            Log.e(<span class="string">"system.out"</span>, <span class="string">"decryptString error: decrypt result is null or length &lt;= 0"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String plainText = <span class="keyword">new</span> String(data, DEFAULT_ENCODE);</span><br><span class="line">            <span class="keyword">return</span> plainText;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加密文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 源文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 加密文件，文件名：encrypt_xxx</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> File <span class="title">encryptFile</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!mCrypto.isAvailable()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == file) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String originFilePath = file.getAbsolutePath();</span><br><span class="line">        String encryptFilePath = String.format(<span class="string">"%s%s%s%s"</span>, file.getParent(), File.separator, PREFIX_E, file.getName());</span><br><span class="line"></span><br><span class="line">        File encryptFile = <span class="keyword">new</span> File(encryptFilePath);</span><br><span class="line">        <span class="keyword">if</span> (encryptFile.exists()) &#123;</span><br><span class="line">            encryptFile.deleteOnExit();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileInputStream sourceFile = <span class="keyword">new</span> FileInputStream(originFilePath);</span><br><span class="line"></span><br><span class="line">            OutputStream fileOS = <span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(encryptFile));</span><br><span class="line">            OutputStream out = mCrypto.getCipherOutputStream(fileOS, mEntity);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> read = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> ((read = sourceFile.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                out.write(buffer, <span class="number">0</span>, read);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            out.flush();</span><br><span class="line">            fileOS.flush();</span><br><span class="line">            out.close();</span><br><span class="line">            fileOS.close();</span><br><span class="line"></span><br><span class="line">            sourceFile.close();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> encryptFile;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CryptoInitializationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyChainException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解密文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 源文件(加密后的)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 解密文件,文件名：decrypt_xxx</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> File <span class="title">decryptFile</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!mCrypto.isAvailable()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == file) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String fileName = file.getName();</span><br><span class="line">        fileName = fileName.substring(PREFIX_E.length(), fileName.length());</span><br><span class="line">        String originFilePath = file.getAbsolutePath();</span><br><span class="line">        String decryptFilePath = String.format(<span class="string">"%s%s%s%s"</span>, file.getParent(), File.separator, PREFIX_D, fileName);</span><br><span class="line"></span><br><span class="line">        File decryptFile = <span class="keyword">new</span> File(decryptFilePath);</span><br><span class="line">        <span class="keyword">if</span> (decryptFile.exists()) &#123;</span><br><span class="line">            decryptFile.deleteOnExit();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(originFilePath);</span><br><span class="line">            InputStream inputStream = mCrypto.getCipherInputStream(fileInputStream, mEntity);</span><br><span class="line"></span><br><span class="line">            OutputStream out = <span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(decryptFile));</span><br><span class="line">            <span class="keyword">int</span> read = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> ((read = inputStream.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                out.write(buffer, <span class="number">0</span>, read);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            out.flush();</span><br><span class="line">            out.close();</span><br><span class="line"></span><br><span class="line">            inputStream.close();</span><br><span class="line">            fileInputStream.close();</span><br><span class="line">            <span class="keyword">return</span> decryptFile;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CryptoInitializationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyChainException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="在项目的Application的onCreate-函数中初始化"><a href="#在项目的Application的onCreate-函数中初始化" class="headerlink" title="在项目的Application的onCreate()函数中初始化"></a>在项目的Application的onCreate()函数中初始化</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line"></span><br><span class="line">        ConcealHelper.init(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="加密字符串"><a href="#加密字符串" class="headerlink" title="加密字符串"></a>加密字符串</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String encryptText = ConcealHelper.encryptString(jsonStr);</span><br></pre></td></tr></table></figure>
<h4 id="解密字符串"><a href="#解密字符串" class="headerlink" title="解密字符串"></a>解密字符串</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String originalText = ConcealHelper.decryptString(encryptText);</span><br></pre></td></tr></table></figure>
<p>中间我们还加了一层Base64编码，因为Conceal的加解密都是针对byte[],使用Base64对其编码，转换为字符串</p>
<p>测试发现很长的一串Json，每次加密时间基本在10 ms以内，解密时间与加密差不多，可以说是飞快了。</p>
<h4 id="加密文件"><a href="#加密文件" class="headerlink" title="加密文件"></a>加密文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File originalFile = <span class="keyword">new</span> File(<span class="string">"/sdcard/1.gif"</span>);</span><br><span class="line">File encryptFile = ConcealHelper.encryptFile(originalFile);</span><br></pre></td></tr></table></figure>
<h4 id="解密文件"><a href="#解密文件" class="headerlink" title="解密文件"></a>解密文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">File decryptFile = ConcealHelper.decryptFile(encryptFile);</span><br></pre></td></tr></table></figure>
<h3 id="SecretKey"><a href="#SecretKey" class="headerlink" title="SecretKey"></a>SecretKey</h3><p>在上面的初始化函数中，有个获取secret的操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String secretKey = SecretKeyHelper.getSecretKey(context);</span><br></pre></td></tr></table></figure>
<p>这个Key是我们的重点，就是我们所说的密钥，实际上就是一串字符串，保存在sd卡不安全，我们可以通过jni，每次从so文件获取，因为相比较而言，so破解少一些，难一点。</p>
<h4 id="创建一个SecretKeyHelper类"><a href="#创建一个SecretKeyHelper类" class="headerlink" title="创建一个SecretKeyHelper类"></a>创建一个SecretKeyHelper类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.robinx.lib.encrypt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecretKeyHelper</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		System.loadLibrary(<span class="string">"secretkey"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String sSecretKeyText;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSecretKey</span><span class="params">(Context con)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (sSecretKeyText ==<span class="keyword">null</span>) &#123;</span><br><span class="line">			sSecretKeyText =createSecretKey(con);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sSecretKeyText;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">createSecretKey</span><span class="params">(Context con)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="C-实现"><a href="#C-实现" class="headerlink" title="C++实现"></a>C++实现</h4><p>创建native方法createSecretKey由C++实现</p>
<h5 id="头文件secretkey-h"><a href="#头文件secretkey-h" class="headerlink" title="头文件secretkey.h"></a>头文件secretkey.h</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#define UTF_8 "UTF-8"</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line"></span><br><span class="line">extern <span class="string">"C"</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="function">jstring <span class="title">Java_net_robinx_lib_encrypt_SecretKeyHelper_createSecretKey</span><span class="params">(JNIEnv *, jobject,jobject)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<h5 id="cpp文件secretkey-cpp"><a href="#cpp文件secretkey-cpp" class="headerlink" title="cpp文件secretkey.cpp"></a>cpp文件secretkey.cpp</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"secretkey.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG_TAG <span class="meta-string">"robin_jni"</span> <span class="comment">// 自定义的LOG的标识</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGOPEN 1 <span class="comment">//日志开关，1为开，其它为关</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGD(...) __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG ,__VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGI(...)  __android_log_print(ANDROID_LOG_INFO,LOG_TAG,__VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGW(...) __android_log_print(ANDROID_LOG_WARN,TAG ,__VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGE(...) __android_log_print(ANDROID_LOG_ERROR,TAG ,__VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGF(...) __android_log_print(ANDROID_LOG_FATAL,TAG ,__VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//char* to jstring</span></span><br><span class="line"><span class="function">jstring <span class="title">toString</span><span class="params">(JNIEnv* env, jbyteArray byteArray)</span> </span>&#123;</span><br><span class="line">	jclass string_cls = env-&gt;FindClass(<span class="string">"java/lang/String"</span>);</span><br><span class="line">	jmethodID new_string_mid = env-&gt;GetMethodID(string_cls, <span class="string">"&lt;init&gt;"</span>,</span><br><span class="line">			<span class="string">"([BLjava/lang/String;)V"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;jstring&gt;(env-&gt;NewObject(string_cls, new_string_mid,</span><br><span class="line">			byteArray, env-&gt;NewStringUTF(UTF_8)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jbyteArray <span class="title">toBytes</span><span class="params">(JNIEnv* env, <span class="keyword">const</span> <span class="keyword">char</span>* bytes)</span> </span>&#123;</span><br><span class="line">	jclass string_cls = env-&gt;FindClass(<span class="string">"java/lang/String"</span>);</span><br><span class="line">	jmethodID get_bytes_mid = env-&gt;GetMethodID(string_cls, <span class="string">"getBytes"</span>,</span><br><span class="line">			<span class="string">"(Ljava/lang/String;)[B"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;jbyteArray&gt;(env-&gt;CallObjectMethod(</span><br><span class="line">			env-&gt;NewStringUTF(bytes), get_bytes_mid, env-&gt;NewStringUTF(UTF_8)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jbyteArray <span class="title">toBytes</span><span class="params">(JNIEnv* env, jstring <span class="built_in">string</span>)</span> </span>&#123;</span><br><span class="line">	jclass string_cls = env-&gt;FindClass(<span class="string">"java/lang/String"</span>);</span><br><span class="line">	jmethodID get_bytes_mid = env-&gt;GetMethodID(string_cls, <span class="string">"getBytes"</span>,</span><br><span class="line">			<span class="string">"(Ljava/lang/String;)[B"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;jbyteArray&gt;(env-&gt;CallObjectMethod(<span class="built_in">string</span>,</span><br><span class="line">			get_bytes_mid, env-&gt;NewStringUTF(UTF_8)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jbyteArray <span class="title">getDigestedBytes</span><span class="params">(JNIEnv* env, jbyteArray complex_bytes)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> jobject satic_message_digest_obj = __null;</span><br><span class="line">	jclass message_digest_cls = env-&gt;FindClass(<span class="string">"java/security/MessageDigest"</span>);</span><br><span class="line">	jmethodID get_instance_mid = env-&gt;GetStaticMethodID(message_digest_cls,</span><br><span class="line">			<span class="string">"getInstance"</span>, <span class="string">"(Ljava/lang/String;)Ljava/security/MessageDigest;"</span>);</span><br><span class="line">	<span class="keyword">if</span> (satic_message_digest_obj == __null) &#123;</span><br><span class="line">		jobject local_message_digest_obj = env-&gt;CallStaticObjectMethod(</span><br><span class="line">				message_digest_cls, get_instance_mid, env-&gt;NewStringUTF(<span class="string">"MD5"</span>));</span><br><span class="line">		satic_message_digest_obj = env-&gt;NewGlobalRef(local_message_digest_obj);</span><br><span class="line">		env-&gt;DeleteLocalRef(local_message_digest_obj);</span><br><span class="line">	&#125;</span><br><span class="line">	jmethodID digest_mid = env-&gt;GetMethodID(message_digest_cls, <span class="string">"digest"</span>,</span><br><span class="line">			<span class="string">"([B)[B"</span>);</span><br><span class="line">	env-&gt;DeleteLocalRef(message_digest_cls);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;jbyteArray&gt;(env-&gt;CallObjectMethod(</span><br><span class="line">			satic_message_digest_obj, digest_mid, complex_bytes));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jstring <span class="title">toHex</span><span class="params">(JNIEnv* env, jbyteArray digested_bytes)</span> </span>&#123;</span><br><span class="line">	jclass big_integer_cls = env-&gt;FindClass(<span class="string">"java/math/BigInteger"</span>);</span><br><span class="line">	jmethodID new_big_integer_mid = env-&gt;GetMethodID(big_integer_cls, <span class="string">"&lt;init&gt;"</span>,</span><br><span class="line">			<span class="string">"(I[B)V"</span>);</span><br><span class="line">	jobject big_integer_obj = env-&gt;NewObject(big_integer_cls,</span><br><span class="line">			new_big_integer_mid, <span class="number">1</span>, digested_bytes);</span><br><span class="line">	env-&gt;DeleteLocalRef(digested_bytes);</span><br><span class="line">	jmethodID to_String_mid = env-&gt;GetMethodID(big_integer_cls, <span class="string">"toString"</span>,</span><br><span class="line">			<span class="string">"(I)Ljava/lang/String;"</span>);</span><br><span class="line">	env-&gt;DeleteLocalRef(big_integer_cls);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;jstring&gt;(env-&gt;CallObjectMethod(big_integer_obj,</span><br><span class="line">			to_String_mid, <span class="number">16</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jstring <span class="title">getMD5</span><span class="params">(JNIEnv* env, jstring jInfo)</span> </span>&#123;</span><br><span class="line">	jbyteArray digested_bytes = getDigestedBytes(env, toBytes(env, jInfo));</span><br><span class="line">	<span class="keyword">return</span> toHex(env, digested_bytes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jstring <span class="title">getAppendedString</span><span class="params">(JNIEnv* env, jobject thiz, jstring s1, jstring s2)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *s1x = (env)-&gt;GetStringUTFChars(s1, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *s2x = (env)-&gt;GetStringUTFChars(s2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">char</span> *sall = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="built_in">strlen</span>(s1x) + <span class="built_in">strlen</span>(s2x) + <span class="number">1</span>];</span><br><span class="line">	<span class="built_in">strcpy</span>(sall, s1x);</span><br><span class="line">	<span class="built_in">strcat</span>(sall, s2x);</span><br><span class="line"></span><br><span class="line">	jstring retval = (env)-&gt;NewStringUTF(sall);</span><br><span class="line"></span><br><span class="line">	(env)-&gt;ReleaseStringUTFChars(s1, s1x);</span><br><span class="line">	(env)-&gt;ReleaseStringUTFChars(s2, s2x);</span><br><span class="line">	<span class="built_in">free</span>(sall);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jobject <span class="title">getInstance</span><span class="params">(JNIEnv* env, jclass obj_class)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	jmethodID construction_id = env-&gt;GetMethodID(obj_class, <span class="string">"&lt;init&gt;"</span>, <span class="string">"()V"</span>);</span><br><span class="line"></span><br><span class="line">	jobject obj = env-&gt;NewObject(obj_class, construction_id);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> obj;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取deviceid</span></span><br><span class="line"><span class="function">jstring <span class="title">getDeviceID</span><span class="params">(JNIEnv *env, jobject thiz, jobject mContext)</span> </span>&#123;</span><br><span class="line">	jclass cls_context = (env)-&gt;FindClass(<span class="string">"android/content/Context"</span>);</span><br><span class="line">	<span class="keyword">if</span> (cls_context == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> (env)-&gt;NewStringUTF(<span class="string">"unknown"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	jmethodID getSystemService = (env)-&gt;GetMethodID(cls_context,</span><br><span class="line">			<span class="string">"getSystemService"</span>, <span class="string">"(Ljava/lang/String;)Ljava/lang/Object;"</span>);</span><br><span class="line">	<span class="keyword">if</span> (getSystemService == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> (env)-&gt;NewStringUTF(<span class="string">"unknown"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	jfieldID TELEPHONY_SERVICE = (env)-&gt;GetStaticFieldID(cls_context,</span><br><span class="line">			<span class="string">"TELEPHONY_SERVICE"</span>, <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">	<span class="keyword">if</span> (TELEPHONY_SERVICE == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> (env)-&gt;NewStringUTF(<span class="string">"unknown"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	jobject str = (env)-&gt;GetStaticObjectField(cls_context, TELEPHONY_SERVICE);</span><br><span class="line">	jobject telephonymanager = (env)-&gt;CallObjectMethod(mContext,</span><br><span class="line">			getSystemService, str);</span><br><span class="line">	<span class="keyword">if</span> (telephonymanager == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> (env)-&gt;NewStringUTF(<span class="string">"unknown"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	jclass cls_tm = (env)-&gt;FindClass(<span class="string">"android/telephony/TelephonyManager"</span>);</span><br><span class="line">	<span class="keyword">if</span> (cls_tm == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> (env)-&gt;NewStringUTF(<span class="string">"unknown"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	jmethodID getDeviceId = (env)-&gt;GetMethodID(cls_tm, <span class="string">"getDeviceId"</span>,</span><br><span class="line">			<span class="string">"()Ljava/lang/String;"</span>);</span><br><span class="line">	<span class="keyword">if</span> (getDeviceId == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> (env)-&gt;NewStringUTF(<span class="string">"unknown"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	jobject deviceid = (env)-&gt;CallObjectMethod(telephonymanager, getDeviceId);</span><br><span class="line">	<span class="keyword">return</span> (jstring) deviceid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取SerialNumber</span></span><br><span class="line"><span class="function">jstring <span class="title">getSerialNumber</span><span class="params">(JNIEnv *env, jobject thiz, jobject mContext)</span> </span>&#123;</span><br><span class="line">	jclass cls_tm = (env)-&gt;FindClass(<span class="string">"android/os/SystemProperties"</span>);</span><br><span class="line">	<span class="keyword">if</span> (cls_tm == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> (env)-&gt;NewStringUTF(<span class="string">"unknown"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	jmethodID getDeviceId = (env)-&gt;GetStaticMethodID(cls_tm, <span class="string">"get"</span>,</span><br><span class="line">			<span class="string">"(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line">	<span class="keyword">if</span> (getDeviceId == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> (env)-&gt;NewStringUTF(<span class="string">"unknown"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	jstring param1 = (env)-&gt;NewStringUTF(<span class="string">"ro.serialno"</span>);</span><br><span class="line">	jstring param2 = (env)-&gt;NewStringUTF(<span class="string">"unknown"</span>);</span><br><span class="line">	jobject deviceid = (env)-&gt;CallStaticObjectMethod(cls_tm, getDeviceId,</span><br><span class="line">			param1, param2);</span><br><span class="line">	<span class="keyword">return</span> (jstring) deviceid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">jstring <span class="title">jint2jstring</span><span class="params">(JNIEnv *env, jint first)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">64</span>]; <span class="comment">// assumed large enough to cope with result</span></span><br><span class="line">  <span class="built_in">sprintf</span>(buf, <span class="string">"%d"</span>, first);  <span class="comment">// error checking omitted</span></span><br><span class="line">  <span class="keyword">return</span> env-&gt;NewStringUTF( buf);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取公钥</span></span><br><span class="line"><span class="function">jstring <span class="title">getPublicKey</span><span class="params">(JNIEnv* env, jobject thiz,jobject context)</span> </span>&#123;</span><br><span class="line">	jclass context_cls = env-&gt;GetObjectClass(context);</span><br><span class="line">	jmethodID get_package_manager_mid = env-&gt;GetMethodID(context_cls,</span><br><span class="line">			<span class="string">"getPackageManager"</span>, <span class="string">"()Landroid/content/pm/PackageManager;"</span>);</span><br><span class="line">	jmethodID get_package_name_mid = env-&gt;GetMethodID(context_cls,</span><br><span class="line">			<span class="string">"getPackageName"</span>, <span class="string">"()Ljava/lang/String;"</span>);</span><br><span class="line">	env-&gt;DeleteLocalRef(context_cls);</span><br><span class="line">	jobject pm_obj = env-&gt;CallObjectMethod(context, get_package_manager_mid);</span><br><span class="line">	jclass pm_cls = env-&gt;FindClass(<span class="string">"android/content/pm/PackageManager"</span>);</span><br><span class="line">	jmethodID get_package_info_mid = env-&gt;GetMethodID(pm_cls, <span class="string">"getPackageInfo"</span>,</span><br><span class="line">			<span class="string">"(Ljava/lang/String;I)Landroid/content/pm/PackageInfo;"</span>);</span><br><span class="line">	jstring package_name = <span class="keyword">reinterpret_cast</span>&lt;jstring&gt;(env-&gt;CallObjectMethod(</span><br><span class="line">			context, get_package_name_mid));</span><br><span class="line">	jfieldID flag_fid = env-&gt;GetStaticFieldID(pm_cls, <span class="string">"GET_SIGNATURES"</span>, <span class="string">"I"</span>);</span><br><span class="line">	jint flag = env-&gt;GetStaticIntField(pm_cls, flag_fid);</span><br><span class="line">	env-&gt;DeleteLocalRef(pm_cls);</span><br><span class="line">	jobject pi_obj = env-&gt;CallObjectMethod(pm_obj, get_package_info_mid,</span><br><span class="line">			package_name, flag);</span><br><span class="line">	env-&gt;DeleteLocalRef(package_name);</span><br><span class="line">	jclass pi_cls = env-&gt;FindClass(<span class="string">"android/content/pm/PackageInfo"</span>);</span><br><span class="line">	jfieldID signatures_fid = env-&gt;GetFieldID(pi_cls, <span class="string">"signatures"</span>,</span><br><span class="line">			<span class="string">"[Landroid/content/pm/Signature;"</span>);</span><br><span class="line">	env-&gt;DeleteLocalRef(pi_cls);</span><br><span class="line">	jobject sig_obj = env-&gt;GetObjectField(pi_obj, signatures_fid);</span><br><span class="line">	env-&gt;DeleteLocalRef(pi_obj);</span><br><span class="line">	jobjectArray sigs = <span class="keyword">reinterpret_cast</span>&lt;jobjectArray&gt;(sig_obj);</span><br><span class="line"></span><br><span class="line">	jclass signature_cls = env-&gt;FindClass(<span class="string">"android/content/pm/Signature"</span>);</span><br><span class="line">	jmethodID to_byte_array_mid = env-&gt;GetMethodID(signature_cls, <span class="string">"toByteArray"</span>,</span><br><span class="line">			<span class="string">"()[B"</span>);</span><br><span class="line">	jbyteArray sig_bytes = <span class="keyword">reinterpret_cast</span>&lt;jbyteArray&gt;(env-&gt;CallObjectMethod(</span><br><span class="line">			env-&gt;GetObjectArrayElement(sigs, <span class="number">0</span>), to_byte_array_mid));</span><br><span class="line">	jclass certificate_factory_cls = env-&gt;FindClass(</span><br><span class="line">			<span class="string">"java/security/cert/CertificateFactory"</span>);</span><br><span class="line">	jmethodID get_certificate_instance_mid = env-&gt;GetStaticMethodID(</span><br><span class="line">			certificate_factory_cls, <span class="string">"getInstance"</span>,</span><br><span class="line">			<span class="string">"(Ljava/lang/String;)Ljava/security/cert/CertificateFactory;"</span>);</span><br><span class="line">	jobject certificate_factory_obj = env-&gt;CallStaticObjectMethod(</span><br><span class="line">			certificate_factory_cls, get_certificate_instance_mid,</span><br><span class="line">			env-&gt;NewStringUTF(<span class="string">"X509"</span>));</span><br><span class="line">	jmethodID generate_certificate_mid = env-&gt;GetMethodID(</span><br><span class="line">			certificate_factory_cls, <span class="string">"generateCertificate"</span>,</span><br><span class="line">			<span class="string">"(Ljava/io/InputStream;)Ljava/security/cert/Certificate;"</span>);</span><br><span class="line">	env-&gt;DeleteLocalRef(certificate_factory_cls);</span><br><span class="line">	jclass certificate_cls = env-&gt;FindClass(<span class="string">"java/security/cert/Certificate"</span>);</span><br><span class="line">	jclass byte_input_stream_cls = env-&gt;FindClass(</span><br><span class="line">			<span class="string">"java/io/ByteArrayInputStream"</span>);</span><br><span class="line">	jmethodID new_sig_bytes_is_mid = env-&gt;GetMethodID(byte_input_stream_cls,</span><br><span class="line">			<span class="string">"&lt;init&gt;"</span>, <span class="string">"([B)V"</span>);</span><br><span class="line">	jobject sig_bytes_is = env-&gt;NewObject(byte_input_stream_cls,</span><br><span class="line">			new_sig_bytes_is_mid, sig_bytes);</span><br><span class="line">	env-&gt;DeleteLocalRef(sig_bytes);</span><br><span class="line">	env-&gt;DeleteLocalRef(byte_input_stream_cls);</span><br><span class="line">	jobject cert = env-&gt;CallObjectMethod(certificate_factory_obj,</span><br><span class="line">			generate_certificate_mid, sig_bytes_is);</span><br><span class="line">	env-&gt;DeleteLocalRef(sig_bytes_is);</span><br><span class="line">	env-&gt;DeleteLocalRef(certificate_factory_obj);</span><br><span class="line">	jmethodID get_pubic_key_mid = env-&gt;GetMethodID(certificate_cls,</span><br><span class="line">			<span class="string">"getPublicKey"</span>, <span class="string">"()Ljava/security/PublicKey;"</span>);</span><br><span class="line">	env-&gt;DeleteLocalRef(certificate_cls);</span><br><span class="line"></span><br><span class="line">	jobject publicKey  = env-&gt;CallObjectMethod(cert, get_pubic_key_mid);</span><br><span class="line">	jclass publicKey_cls = env-&gt;GetObjectClass(publicKey);</span><br><span class="line">	jmethodID toString_mid = env-&gt;GetMethodID(publicKey_cls,<span class="string">"toString"</span>, <span class="string">"()Ljava/lang/String;"</span>);</span><br><span class="line">	jstring publicKey_str = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;CallObjectMethod(publicKey,toString_mid));</span><br><span class="line">	env-&gt;DeleteLocalRef(cert);</span><br><span class="line">	env-&gt;DeleteLocalRef(publicKey_cls);</span><br><span class="line">	env-&gt;DeleteLocalRef(publicKey);</span><br><span class="line"></span><br><span class="line">	jclass string_cls = env-&gt;GetObjectClass(publicKey_str);</span><br><span class="line">	jmethodID indexOf_mid = env-&gt;GetMethodID(string_cls,<span class="string">"indexOf"</span>, <span class="string">"(Ljava/lang/String;)I"</span>);</span><br><span class="line">	jstring param = env-&gt;NewStringUTF(<span class="string">"modulus"</span>);</span><br><span class="line">	jint aa = env-&gt;CallIntMethod(publicKey_str,indexOf_mid,param);</span><br><span class="line">	jstring param2 = env-&gt;NewStringUTF(<span class="string">"publicExponent"</span>);</span><br><span class="line">	jint bb = env-&gt;CallIntMethod(publicKey_str,indexOf_mid,param2);</span><br><span class="line"></span><br><span class="line">	jmethodID substring_mid = env-&gt;GetMethodID(string_cls,<span class="string">"substring"</span>, <span class="string">"(II)Ljava/lang/String;"</span>);</span><br><span class="line"></span><br><span class="line">	jstring publicKey2_str = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;CallObjectMethod(publicKey_str,substring_mid,aa+<span class="number">8</span>,bb<span class="number">-1</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> publicKey2_str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取签名</span></span><br><span class="line"><span class="function">jstring <span class="title">getSignatures</span><span class="params">(JNIEnv* env, jobject thizz,</span></span></span><br><span class="line"><span class="function"><span class="params">		jobject thiz)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	jclass native_clazz = env-&gt;GetObjectClass(thiz);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 得到 getPackageManager 方法的 ID</span></span><br><span class="line">	jmethodID methodID_func = env-&gt;GetMethodID(native_clazz,</span><br><span class="line">			<span class="string">"getPackageManager"</span>, <span class="string">"()Landroid/content/pm/PackageManager;"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得应用包的管理器</span></span><br><span class="line">	jobject package_manager = env-&gt;CallObjectMethod(thiz, methodID_func);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得 PackageManager 类</span></span><br><span class="line">	jclass pm_clazz = env-&gt;GetObjectClass(package_manager);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 得到 getPackageInfo 方法的 ID</span></span><br><span class="line">	jmethodID methodID_pm = env-&gt;GetMethodID(pm_clazz, <span class="string">"getPackageInfo"</span>,</span><br><span class="line">			<span class="string">"(Ljava/lang/String;I)Landroid/content/pm/PackageInfo;"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取包名</span></span><br><span class="line">	jmethodID methodID_packagename = env-&gt;GetMethodID(native_clazz,</span><br><span class="line">			<span class="string">"getPackageName"</span>, <span class="string">"()Ljava/lang/String;"</span>);</span><br><span class="line">	jstring name_str = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;CallObjectMethod(thiz,</span><br><span class="line">			methodID_packagename));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得应用包的信息</span></span><br><span class="line">	jobject package_info = env-&gt;CallObjectMethod(package_manager, methodID_pm,</span><br><span class="line">			name_str, <span class="number">64</span>);		<span class="comment">//env-&gt;NewStringUTF("com.example.contasdf")</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得 PackageInfo 类</span></span><br><span class="line">	jclass pi_clazz = env-&gt;GetObjectClass(package_info);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得签名数组属性的 ID</span></span><br><span class="line">	jfieldID fieldID_signatures = env-&gt;GetFieldID(pi_clazz, <span class="string">"signatures"</span>,</span><br><span class="line">			<span class="string">"[Landroid/content/pm/Signature;"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 得到签名数组，待修改</span></span><br><span class="line">	jobject signatur = env-&gt;GetObjectField(package_info, fieldID_signatures);</span><br><span class="line">	jobjectArray signatures = <span class="keyword">reinterpret_cast</span>&lt;jobjectArray&gt;(signatur);</span><br><span class="line">	<span class="comment">// 得到签名</span></span><br><span class="line">	jobject signature = env-&gt;GetObjectArrayElement(signatures, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得 Signature 类，待修改</span></span><br><span class="line">	jclass s_clazz = env-&gt;GetObjectClass(signature);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 得到 hashCode 方法的 ID</span></span><br><span class="line">	jmethodID methodID_hc = env-&gt;GetMethodID(s_clazz, <span class="string">"hashCode"</span>, <span class="string">"()I"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得应用包的管理器，待修改</span></span><br><span class="line">	<span class="keyword">int</span> hash_code = env-&gt;CallIntMethod(signature, methodID_hc);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">100</span>];</span><br><span class="line">	<span class="built_in">sprintf</span>(str, <span class="string">"%u"</span>, hash_code);</span><br><span class="line"></span><br><span class="line">	jstring sign = env-&gt;NewStringUTF(str);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sign;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jstring <span class="title">getPackageName</span><span class="params">(JNIEnv* env, jobject thizz,jobject thiz)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	jclass native_clazz = env-&gt;GetObjectClass(thiz);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 得到 getPackageManager 方法的 ID</span></span><br><span class="line">	jmethodID methodID_func = env-&gt;GetMethodID(native_clazz,</span><br><span class="line">			<span class="string">"getPackageManager"</span>, <span class="string">"()Landroid/content/pm/PackageManager;"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得应用包的管理器</span></span><br><span class="line">	jobject package_manager = env-&gt;CallObjectMethod(thiz, methodID_func);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得 PackageManager 类</span></span><br><span class="line">	jclass pm_clazz = env-&gt;GetObjectClass(package_manager);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 得到 getPackageInfo 方法的 ID</span></span><br><span class="line">	jmethodID methodID_pm = env-&gt;GetMethodID(pm_clazz, <span class="string">"getPackageInfo"</span>,</span><br><span class="line">			<span class="string">"(Ljava/lang/String;I)Landroid/content/pm/PackageInfo;"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取包名</span></span><br><span class="line">	jmethodID methodID_packagename = env-&gt;GetMethodID(native_clazz,</span><br><span class="line">			<span class="string">"getPackageName"</span>, <span class="string">"()Ljava/lang/String;"</span>);</span><br><span class="line">	jstring name_str = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;CallObjectMethod(thiz,</span><br><span class="line">			methodID_packagename));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> name_str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">jstringTostring</span><span class="params">(JNIEnv* env, jstring jstr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span>* rtn = <span class="literal">NULL</span>;</span><br><span class="line">	jclass clsstring = env-&gt;FindClass(<span class="string">"java/lang/String"</span>);</span><br><span class="line">	jstring strencode = env-&gt;NewStringUTF(<span class="string">"utf-8"</span>);</span><br><span class="line">	jmethodID mid = env-&gt;GetMethodID(clsstring, <span class="string">"getBytes"</span>, <span class="string">"(Ljava/lang/String;)[B"</span>);</span><br><span class="line">	jbyteArray barr= (jbyteArray)env-&gt;CallObjectMethod(jstr, mid, strencode);</span><br><span class="line">	jsize alen = env-&gt;GetArrayLength(barr);</span><br><span class="line">	jbyte* ba = env-&gt;GetByteArrayElements(barr, JNI_FALSE);</span><br><span class="line">	<span class="keyword">if</span> (alen &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		rtn = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(alen + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">memcpy</span>(rtn, ba, alen);</span><br><span class="line">		rtn[alen] = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	env-&gt;ReleaseByteArrayElements(barr, ba, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> rtn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jstring <span class="title">Java_net_robinx_lib_encrypt_SecretKeyHelper_createSecretKey</span><span class="params">(JNIEnv* env, jobject thizz,</span></span></span><br><span class="line"><span class="function"><span class="params">		jobject thiz)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	jstring imei = getAppendedString(env, thizz, getDeviceID(env, thizz, thiz),getSerialNumber(env, thizz, thiz));</span><br><span class="line">	<span class="keyword">if</span> (LOGOPEN == <span class="number">1</span>)&#123;</span><br><span class="line">		LOGD(<span class="string">"imei = %s"</span>,jstringTostring(env,imei));</span><br><span class="line">	&#125;</span><br><span class="line">	jstring sign = getPublicKey(env, thizz, thiz);</span><br><span class="line">	<span class="keyword">if</span> (LOGOPEN == <span class="number">1</span>)&#123;</span><br><span class="line">		LOGD(<span class="string">"sign = %s"</span>,jstringTostring(env,sign));</span><br><span class="line">	&#125;</span><br><span class="line">	jstring imei_sign = getAppendedString(env, thizz, imei, sign);</span><br><span class="line">	<span class="keyword">if</span> (LOGOPEN == <span class="number">1</span>)&#123;</span><br><span class="line">		LOGD(<span class="string">"imei_sign = %s"</span>,jstringTostring(env,imei_sign));</span><br><span class="line">	&#125;</span><br><span class="line">	jstring package = getPackageName(env, thizz, thiz);</span><br><span class="line">	<span class="keyword">if</span> (LOGOPEN == <span class="number">1</span>)&#123;</span><br><span class="line">		LOGD(<span class="string">"package = %s"</span>,jstringTostring(env,package));</span><br><span class="line">	&#125;</span><br><span class="line">	jstring imei_sign_package = getAppendedString(env, thizz, imei_sign,package);</span><br><span class="line">	<span class="keyword">if</span> (LOGOPEN == <span class="number">1</span>)&#123;</span><br><span class="line">		LOGD(<span class="string">"imei_sign_package = %s"</span>,jstringTostring(env,imei_sign_package));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	imei_sign_package = getAppendedString(env, thizz, imei_sign_package, imei);</span><br><span class="line">	<span class="keyword">if</span> (LOGOPEN == <span class="number">1</span>)&#123;</span><br><span class="line">		LOGD(<span class="string">"imei_sign_package2 = %s"</span>,jstringTostring(env,imei_sign_package));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	imei_sign_package = getAppendedString(env, thizz, imei_sign_package, sign);</span><br><span class="line">	<span class="keyword">if</span> (LOGOPEN == <span class="number">1</span>)&#123;</span><br><span class="line">		LOGD(<span class="string">"imei_sign_package3 = %s"</span>,jstringTostring(env,imei_sign_package));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	jstring secretKey = getMD5(env, imei_sign_package);</span><br><span class="line">	<span class="keyword">if</span> (LOGOPEN == <span class="number">1</span>)&#123;</span><br><span class="line">		LOGD(<span class="string">"secretKey = %s"</span>,jstringTostring(env,secretKey));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> secretKey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Application-mk文件"><a href="#Application-mk文件" class="headerlink" title="Application.mk文件"></a>Application.mk文件</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">APP_STL := stlport_static</span><br><span class="line"></span><br><span class="line">APP_ABI := all</span><br><span class="line">APP_PLATFORM:= android-<span class="number">22</span></span><br><span class="line">APP_OPTIM	:= release</span><br></pre></td></tr></table></figure>
<h5 id="Android-mk文件"><a href="#Android-mk文件" class="headerlink" title="Android.mk文件"></a>Android.mk文件</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH:=$(call my-dir)</span><br><span class="line"></span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line"></span><br><span class="line">LOCAL_MODULE:=secretkey</span><br><span class="line"></span><br><span class="line">LOCAL_SRC_FILES:=secretkey.cpp secretkey.h</span><br><span class="line"></span><br><span class="line">LOCAL_LDLIBS :=-llog</span><br><span class="line"></span><br><span class="line">include $(BUILD_SHARED_LIBRARY)</span><br></pre></td></tr></table></figure>
<p>最终返回imei(手机IMEI)+sign(签名)+package(包名)+imei(手机IMEI)+sign(签名)的MD5结果，你可以修改cpp末尾位置，自己组合，穿插添加其他的字符串<br>做到唯一性</p>
<p>这样整个加密流程就完毕了，用起来很方便</p>
<h2 id="代码获取"><a href="#代码获取" class="headerlink" title="代码获取"></a>代码获取</h2><p><a href="https://github.com/robinxdroid/Encrypt" target="_blank" rel="noopener">https://github.com/robinxdroid/Encrypt</a> </p>
<blockquote>
<p>转载请指明出处RobinBlog：<a href="http://robinx.net/2016/11/30/加密你的App/" target="_blank" rel="noopener">http://robinx.net/2016/11/30/加密你的App/</a></p>
</blockquote>

    
  </div>
  
    
      
<!-- Gitalk评论插件通用代码 -->
<div id="git"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
const gitalk = new Gitalk({
  clientID: 'd91a7e64d2a3c319f65b',
  clientSecret: 'ee46d5b1ae5c3cde56f5c4ea894353b10892076d',
  repo: 'BlogComments',
  owner: 'robinxdroid',
  admin: ['robinxdroid'],
  // facebook-like distraction free mode
  distractionFreeMode: false
})
gitalk.render('git')
</script>
<!-- Gitalk代码结束 -->

  
  
</article>

</div>





  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    




  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
